{% load static %}
<!-- Include Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% load static %}
<link rel="stylesheet" href="{% static 'pop_ups/create_task_pop_up.css' %}">
<h1>Task List</h1>
<table class="table">
    <thead>
        <tr>
            <th>Task</th>
            <th>Status</th>
            <th>Assigned To</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr>
            <td>{{ task.content }}</td>
            <td>{{ task.get_status_display }}</td>
 
            <td>
                <!-- Edit Task Button -->
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editTaskModal" data-task-id="{{ task.task_id }}">Edit Task</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Edit Task Modal (Initially empty) -->
<div class="modal fade" id="editTaskModal" tabindex="-1" aria-labelledby="editTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" id="editTaskModalContent">
            <!-- Modal content will be dynamically injected here -->
        </div>
    </div>
</div>

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        // When the Edit Task button is clicked
        $('.btn-primary').click(function () {
            // Get the task ID from the button's data-task-id attribute
            var taskId = $(this).data('task-id');
            
            // Send an AJAX request to fetch the edit form for this task
            $.ajax({
                url: '{% url "task:edit_task" 0 %}'.replace("0", taskId),  // Replace task ID dynamically
                method: 'GET',
                success: function (data) {
                    // Insert the fetched form into the modal content
                    $('#editTaskModalContent').html(data);
                    
                    // Show the modal
                    $('#editTaskModal').modal('show');
                },
                error: function () {
                    alert("Failed to load the edit form. Please try again.");
                }
            });
        });
    });
</script>
